# 0.对PDF文件的格式进行简要的说明

参考 onlyPDF/others/pdf_files/sample.pdf文件

# 1.PDF文件结构
pdf文件的结构包括：

1.header, PDF版本号

```bash
%PDF-1.0 % Header，提供PDF版本号
%âãÏÓ % 这里是为了让文件传输程序确定文件是二进制文件，会在标头中包含，字符代码高于127的字节
```

2.body,页面，图像等

包含页面，图形内容和大部分辅助信息，全部编码为一系列向量

```bash
1 0 obj % 对象编号 世代号 关键字obj
<<
/Kids [2 0 R]
/Count 1
/Type /Pages
>>
endobj % 关键字endobj
2 0 obj
<<
25
/Rotate 0
/Parent 1 0 R
/Resources 3 0 R
/MediaBox [0 0 612 792]
/Contents [4 0 R]
/Type /Page
>>
endobj
3 0 obj
<<
/Font
<<
/F0
<<
/BaseFont /Times-Italic
/Subtype /Type1
/Type /Font
>>
>>
>>
endobj
4 0 obj
<<
/Length 65
>>
stream
1. 0. 0. 1. 50. 700. cm
BT
 /F0 36. Tf
 (Hello, World!) Tj
ET
endstream
endobj
5 0 obj
<<
/Pages 1 0 R
/Type /Catalog
>>
endobj
```
3.交叉引用，列出每个对象的位置，用于随机访问

字节偏移量以前导零存储，以确保每个条目都相同 长度。因此，我们也可以通过随机访问来读取交叉引用表。

```bash
xref 
0 6 % 有6个条目 从0开始
0000000000 65535 f % 特别条目
0000000015 00000 n # 对象1的字节偏移量为15
0000000074 00000 n
0000000192 00000 n
0000000291 00000 n
0000000409 00000 n

```
4.trailer包括trailer字典，用于找到文件的每部分，可以在不处理整个文件的情况下，读取各种元数据
```bash
trailer % 关键词trailer
<< % 预览块字典
/Root 5 0 R
/Size 6
>>
startxref % 交叉引用表开始关键字
459 % 交叉引用表的字节偏移量
%%EOF % 文件结束标记

```

# 2.PDF对象

## 2.1.PDF支持五个基本对象

1.整数和实数

2.字符串：在括号中，有各种编码

3.名称 键
名称在整个PDF中使用，作为字典的键和定义各种多值对象， 其中使用整数枚举它们将是不直观的。一个名称 引入正斜杠。例如：
```bash
/French
```
/字符是名称的一部分 - 事实上，/它本身就是一个有效的名称。 名称可能不包含空格或分隔符，但名称需要与之对应 一些具有这些字符的外部名称（例如空格），我们可以使用哈希符号后跟两个十进制数字：
```bash
/Websafe#20Dark#20Green
```
这表示名称/Websafe Dark Green，因为在ASCII中， 十六进制20是空格的代码。名称区分大小写（/French和/french不同）。
4.布尔值 true和false

5.null对象 null

## 2.2.复合对象

1.数组
```bash
[0 0 400 500]
[/Green /Blue [/Red /Yellow]]
```
2.字典
```bash
<</One 1 /Two 2 /Three 3>>
```
3.包含二进制数据的流和描述数据属性的字典

其中流用于存储二进制数据

```bash
4 0 obj % 对象4
<<
/Length 65 % 数据长度
>>
stream % 流关键字
1. 0. 0. 1. 50. 700. cm % 65字节的数据，这里是图形流
BT
  /F0 36. Tf
  (Hello, World!) Tj
ET
endstream % 结束流关键字
endobj % 对象的结束

```
上面的字典中包含/Length条目，一般二进制数据都被压缩了，压缩如下面所示

```bash
796 0 obj
<</Length 275 /Filter /FlateDecode>> % 流
HTKO0÷ü % 这里还有 268 字节被隐藏，即总计 275 字节
endstream
endobj
```


4.间接引用
```bash
<< /Resources 10 0 R # 对象10
 /Contents [4 0 R] >> # 对象4
```
对象4和10在字典的值中被引用

PDF有对象图组成，间接引用形成他们之间的链接

# 3.特性

## 3.1.增量更新

通过修改附加到文件末尾来更新文件，不需要再次写入整个文件（对于大文件，可能需要横穿时间），

更新构成新的或更改对象，对交叉引用表的更新，保存花费的时间更少，但是文件会更加臃肿，不需要的对象无法删除。

## 3.2.对象和交叉引用流

1.5开始，允许将多个对象放入单个对象流中压缩PDF文件，整个流都被压缩。引入用于引用这些流的对象的新机制，交叉引用流。

将特定时间所需的对象组合在一起，例如每一页中的所有对象，保留了文件的随机访问属性，如果将所有对象都放入单个对象流中，该属性将消失。

## 3.3.线性化PDF

大型文件，网络较慢的时候，用户不希望等待整个文件来查看。

PDF 1.2，添加如何对文件中的对象进行排序

# 4.文档结构

## 4.1.Trailer字典

读取PDF首先需要的任务，包含下面的条目
```bash
/Size*	整数	文件交叉引用表中的条目总数（通常等于文件中的对象数加1）
/Root*	间接引用字典	文件目录
/Info	间接引用字典	文档的文档信息字典
/ID	两个字符串的数组	唯一标识工作流程中的文件。第一个字符串在首次创建文件时确定，第二个字符串在工作流系统修改文件时进行修改
```

例子
```bash
<<
   /Size 421
   /Root 377 0 R
   /Info 375 0 R
   /ID [<75ff22189ceac848dfa2afec93deee03> <057928614d9711db835e000d937095a2>]
>>

```